<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المدفوعات - Quick Link System</title>
    
    <!-- Bootstrap CSS -->
    <link href="assets/css/bootstrap.rtl.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link href="assets/css/custom.css" rel="stylesheet">
    
    <!-- Custom Font -->
    <link href="assets/fonts/JF-Flat-Regular.ttf" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <div id="header-placeholder"></div>
    
    <!-- Sidebar -->
    <div id="sidebar-placeholder"></div>
    
    <!-- Main Content -->
    <div class="main-content-wrapper">
        <main class="main-content">
            <!-- Page Title -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">
                    <i class="fas fa-credit-card me-2 text-success"></i>
                    إدارة المدفوعات
                </h2>
                <button class="btn btn-success" onclick="processNewPayment()">
                    <i class="fas fa-plus me-1"></i>
                    معالجة دفعة جديدة
                </button>
            </div>

            <!-- Search and Filters -->
            <div class="card shadow-custom mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <label class="form-label">البحث</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" class="form-control" placeholder="رقم الطلب أو العميل" id="paymentSearchInput">
                            </div>
                        </div>
                        <div class="col-md-2 mb-3">
                            <label class="form-label">حالة الدفع</label>
                            <select class="form-control" id="paymentStatusFilter">
                                <option value="all">الكل</option>
                                <option value="completed">مكتمل</option>
                                <option value="pending">معلق</option>
                                <option value="failed">فاشل</option>
                                <option value="refunded">مسترد</option>
                            </select>
                        </div>
                        <div class="col-md-2 mb-3">
                            <label class="form-label">بوابة الدفع</label>
                            <select class="form-control" id="gatewayFilter">
                                <option value="all">الكل</option>
                                <option value="paytabs">PayTabs</option>
                                <option value="stripe">Stripe</option>
                                <option value="cash">نقدي</option>
                            </select>
                        </div>
                        <div class="col-md-2 mb-3">
                            <label class="form-label">من تاريخ</label>
                            <input type="date" class="form-control" id="startDateFilter">
                        </div>
                        <div class="col-md-2 mb-3">
                            <label class="form-label">إلى تاريخ</label>
                            <input type="date" class="form-control" id="endDateFilter">
                        </div>
                        <div class="col-md-1 mb-3">
                            <label class="form-label">&nbsp;</label>
                            <div class="d-grid">
                                <button class="btn btn-outline-primary" onclick="clearPaymentFilters()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payment Stats -->
            <div class="row mb-4">
                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card stats-card border-success">
                        <div class="card-body text-center">
                            <i class="fas fa-dollar-sign icon-large text-success"></i>
                            <div class="stats-number text-success">125,450</div>
                            <div class="stats-label">إجمالي المدفوعات (درهم)</div>
                            <small class="text-success">
                                <i class="fas fa-arrow-up"></i> +8.5% من الشهر الماضي
                            </small>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card stats-card border-primary">
                        <div class="card-body text-center">
                            <i class="fas fa-check-circle icon-large text-primary"></i>
                            <div class="stats-number text-primary">156</div>
                            <div class="stats-label">دفعات مكتملة</div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card stats-card border-warning">
                        <div class="card-body text-center">
                            <i class="fas fa-hourglass-half icon-large text-warning"></i>
                            <div class="stats-number text-warning">12</div>
                            <div class="stats-label">دفعات معلقة</div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card stats-card border-danger">
                        <div class="card-body text-center">
                            <i class="fas fa-times-circle icon-large text-danger"></i>
                            <div class="stats-number text-danger">3</div>
                            <div class="stats-label">دفعات فاشلة</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payment Methods Stats -->
            <div class="row mb-4">
                <div class="col-lg-8 mb-4">
                    <div class="card shadow-custom">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-chart-line me-2"></i>
                                إحصائيات المدفوعات الشهرية
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-placeholder">
                                <div class="text-center py-5">
                                    <i class="fas fa-chart-line text-muted" style="font-size: 4rem;"></i>
                                    <h5 class="text-muted mt-3">رسم بياني للمدفوعات</h5>
                                    <p class="text-muted">سيتم عرض الرسم البياني هنا</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 mb-4">
                    <div class="card shadow-custom">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-wallet me-2"></i>
                                بوابات الدفع
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="payment-method-item mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <div>
                                        <i class="fas fa-credit-card text-primary me-2"></i>
                                        <strong>PayTabs</strong>
                                    </div>
                                    <span class="badge bg-success">نشط</span>
                                </div>
                                <div class="progress mb-2">
                                    <div class="progress-bar bg-primary" style="width: 65%">65%</div>
                                </div>
                                <small class="text-muted">102 عملية - 81,250 درهم</small>
                            </div>
                            <hr>
                            <div class="payment-method-item mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <div>
                                        <i class="fas fa-credit-card text-success me-2"></i>
                                        <strong>Stripe</strong>
                                    </div>
                                    <span class="badge bg-success">نشط</span>
                                </div>
                                <div class="progress mb-2">
                                    <div class="progress-bar bg-success" style="width: 25%">25%</div>
                                </div>
                                <small class="text-muted">39 عملية - 31,200 درهم</small>
                            </div>
                            <hr>
                            <div class="payment-method-item">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <div>
                                        <i class="fas fa-money-bill-wave text-warning me-2"></i>
                                        <strong>نقدي</strong>
                                    </div>
                                    <span class="badge bg-info">متاح</span>
                                </div>
                                <div class="progress mb-2">
                                    <div class="progress-bar bg-warning" style="width: 10%">10%</div>
                                </div>
                                <small class="text-muted">15 عملية - 13,000 درهم</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payments Table -->
            <div class="card shadow-custom">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-table me-2"></i>
                        سجل المدفوعات
                    </h5>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-success btn-sm" onclick="exportPaymentsToExcel()">
                            <i class="fas fa-file-excel me-1"></i>
                            تصدير Excel
                        </button>
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="printPaymentReport()">
                            <i class="fas fa-print me-1"></i>
                            طباعة
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="paymentsTable">
                            <thead>
                                <tr>
                                    <th>رقم العملية</th>
                                    <th>رقم الطلب</th>
                                    <th>العميل</th>
                                    <th>المبلغ</th>
                                    <th>بوابة الدفع</th>
                                    <th>الحالة</th>
                                    <th>التاريخ</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>PAY-2025-001</strong></td>
                                    <td>QL-2025-001</td>
                                    <td>أحمد محمد علي</td>
                                    <td><strong class="text-success">420 درهم</strong></td>
                                    <td>
                                        <span class="badge bg-primary">
                                            <i class="fas fa-credit-card"></i>
                                            PayTabs
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-success">
                                            <i class="fas fa-check-circle"></i>
                                            مكتمل
                                        </span>
                                    </td>
                                    <td>20 يناير 2025 - 14:30</td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-action btn-view" onclick="viewPaymentDetails(1)" title="التفاصيل">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-action btn-info" onclick="printReceipt(1)" title="طباعة الإيصال">
                                                <i class="fas fa-receipt"></i>
                                            </button>
                                            <button class="btn btn-action btn-warning" onclick="sendPaymentEmail(1)" title="إرسال بريد">
                                                <i class="fas fa-envelope"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>PAY-2025-002</strong></td>
                                    <td>QL-2025-002</td>
                                    <td>فاطمة عبدالله السعد</td>
                                    <td><strong class="text-warning">750 درهم</strong></td>
                                    <td>
                                        <span class="badge bg-success">
                                            <i class="fas fa-credit-card"></i>
                                            Stripe
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-warning">
                                            <i class="fas fa-hourglass-half"></i>
                                            معلق
                                        </span>
                                    </td>
                                    <td>20 يناير 2025 - 13:15</td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-action btn-view" onclick="viewPaymentDetails(2)" title="التفاصيل">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-action btn-success" onclick="confirmPayment(2)" title="تأكيد">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button class="btn btn-action btn-delete" onclick="cancelPayment(2)" title="إلغاء">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>PAY-2025-003</strong></td>
                                    <td>QL-2025-003</td>
                                    <td>محمد سالم الأحمد</td>
                                    <td><strong class="text-success">650 درهم</strong></td>
                                    <td>
                                        <span class="badge bg-primary">
                                            <i class="fas fa-credit-card"></i>
                                            PayTabs
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-success">
                                            <i class="fas fa-check-circle"></i>
                                            مكتمل
                                        </span>
                                    </td>
                                    <td>19 يناير 2025 - 16:45</td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-action btn-view" onclick="viewPaymentDetails(3)" title="التفاصيل">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-action btn-info" onclick="printReceipt(3)" title="طباعة الإيصال">
                                                <i class="fas fa-receipt"></i>
                                            </button>
                                            <button class="btn btn-action btn-warning" onclick="sendPaymentEmail(3)" title="إرسال بريد">
                                                <i class="fas fa-envelope"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>PAY-2025-004</strong></td>
                                    <td>QL-2025-004</td>
                                    <td>نورا أحمد الخالدي</td>
                                    <td><strong class="text-danger">420 درهم</strong></td>
                                    <td>
                                        <span class="badge bg-success">
                                            <i class="fas fa-credit-card"></i>
                                            Stripe
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-danger">
                                            <i class="fas fa-times-circle"></i>
                                            فاشل
                                        </span>
                                    </td>
                                    <td>19 يناير 2025 - 11:20</td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-action btn-view" onclick="viewPaymentDetails(4)" title="التفاصيل">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-action btn-warning" onclick="retryPayment(4)" title="إعادة المحاولة">
                                                <i class="fas fa-redo"></i>
                                            </button>
                                            <button class="btn btn-action btn-info" onclick="contactCustomer(4)" title="الاتصال بالعميل">
                                                <i class="fas fa-phone"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>PAY-2025-005</strong></td>
                                    <td>QL-2025-005</td>
                                    <td>خالد سعيد المري</td>
                                    <td><strong class="text-info">500 درهم</strong></td>
                                    <td>
                                        <span class="badge bg-warning text-dark">
                                            <i class="fas fa-money-bill-wave"></i>
                                            نقدي
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-info">
                                            <i class="fas fa-undo"></i>
                                            مسترد
                                        </span>
                                    </td>
                                    <td>18 يناير 2025 - 10:00</td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-action btn-view" onclick="viewPaymentDetails(5)" title="التفاصيل">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-action btn-info" onclick="printReceipt(5)" title="طباعة الإيصال">
                                                <i class="fas fa-receipt"></i>
                                            </button>
                                            <button class="btn btn-action btn-warning" onclick="sendPaymentEmail(5)" title="إرسال بريد">
                                                <i class="fas fa-envelope"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Pagination -->
            <nav aria-label="تنقل صفحات المدفوعات" class="mt-4">
                <ul class="pagination justify-content-center">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1">السابق</a>
                    </li>
                    <li class="page-item active">
                        <a class="page-link" href="#">1</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#">2</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#">3</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#">التالي</a>
                    </li>
                </ul>
            </nav>
        </main>
    </div>

    <!-- Footer -->
    <div class="footer-wrapper">
        <div id="footer-placeholder"></div>
    </div>

    <!-- Bootstrap JS -->
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="assets/js/custom.js"></script>
    
    <!-- Page-specific JavaScript -->
    <script>
        function clearPaymentFilters() {
            document.getElementById('paymentSearchInput').value = '';
            document.getElementById('paymentStatusFilter').value = 'all';
            document.getElementById('gatewayFilter').value = 'all';
            document.getElementById('startDateFilter').value = '';
            document.getElementById('endDateFilter').value = '';
        }

        function processNewPayment() {
            showNotification('فتح نموذج معالجة دفعة جديدة...', 'info');
        }

        function viewPaymentDetails(id) {
            showNotification(`عرض تفاصيل الدفعة ${id}`, 'info');
        }

        function printReceipt(id) {
            showNotification(`طباعة إيصال الدفعة ${id}`, 'info');
        }

        function sendPaymentEmail(id) {
            showNotification(`إرسال بريد للدفعة ${id}`, 'success');
        }

        function confirmPayment(id) {
            if (confirm('هل أنت متأكد من تأكيد هذه الدفعة؟')) {
                showNotification(`تم تأكيد الدفعة ${id}`, 'success');
            }
        }

        function cancelPayment(id) {
            if (confirm('هل أنت متأكد من إلغاء هذه الدفعة؟')) {
                showNotification(`تم إلغاء الدفعة ${id}`, 'danger');
            }
        }

        function retryPayment(id) {
            showNotification(`إعادة محاولة الدفعة ${id}`, 'warning');
        }

        function contactCustomer(id) {
            showNotification(`الاتصال بالعميل للدفعة ${id}`, 'info');
        }

        function exportPaymentsToExcel() {
            showNotification('تصدير المدفوعات إلى Excel...', 'info');
        }

        function printPaymentReport() {
            showNotification('طباعة تقرير المدفوعات...', 'info');
        }
    </script>
    
    <!-- Load Components -->
    <script>
        Promise.all([
            fetch('components/header.html').then(r => r.text()),
            fetch('components/sidebar.html').then(r => r.text()),
            fetch('components/footer.html').then(r => r.text())
        ]).then(([header, sidebar, footer]) => {
            document.getElementById('header-placeholder').innerHTML = header;
            document.getElementById('sidebar-placeholder').innerHTML = sidebar;
            document.getElementById('footer-placeholder').innerHTML = footer;
            
            setTimeout(() => {
                if (typeof initializeSystem === 'function') {
                    initializeSystem();
                }
                if (typeof setupSidebarToggle === 'function') {
                    setupSidebarToggle();
                }
            }, 50);
        }).catch(error => {
            console.error('خطأ في تحميل المكونات:', error);
        });
    </script>
</body>
</html>
