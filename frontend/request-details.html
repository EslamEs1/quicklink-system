<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تفاصيل الطلب - Quick Link System</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/bootstrap.rtl.min.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/custom.css">
</head>
<body>
    <!-- Header -->
    <div id="header-placeholder"></div>

    <!-- Sidebar -->
    <div id="sidebar-placeholder"></div>

    <!-- Main Content -->
    <div class="main-content-wrapper">
        <main class="main-content">
            <!-- رأس الصفحة -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="page-title mb-2">
                        <i class="fas fa-file-alt text-primary me-2"></i>
                        تفاصيل الطلب
                    </h2>
                    <p class="page-subtitle text-muted">عرض كامل تفاصيل الطلب والمستندات والإجراءات</p>
                </div>
                <div>
                    <a href="requests.html" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-right me-1"></i>
                        رجوع للطلبات
                    </a>
                </div>
            </div>

            <!-- رقم الطلب والحالة -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h4 class="mb-2">
                                <i class="fas fa-hashtag text-primary me-2"></i>
                                رقم الطلب: <strong id="requestNumber">QL-2025-001</strong>
                            </h4>
                            <p class="text-muted mb-0">
                                <i class="fas fa-calendar me-2"></i>
                                تاريخ الإنشاء: <span id="requestDate">2025-01-15 10:30 ص</span>
                            </p>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <span class="badge bg-warning p-2 fs-6" id="requestStatus">
                                <i class="fas fa-clock me-1"></i>
                                قيد المراجعة
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- بيانات العميل -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-user text-primary me-2"></i>
                        بيانات العميل
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="text-muted mb-1">الاسم الكامل</label>
                            <p class="fw-bold mb-0" id="customerName">أحمد محمد علي السعيد</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted mb-1">رقم الهوية الإماراتية</label>
                            <p class="fw-bold mb-0" id="customerID">784-XXXX-XXXXXXX-X</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted mb-1">رقم الجوال</label>
                            <p class="mb-0">
                                <button class="btn btn-sm btn-outline-primary" onclick="callCustomer()">
                                    <i class="fas fa-phone me-1"></i>
                                    اتصال عبر WhatsApp Business
                                </button>
                            </p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted mb-1">البريد الإلكتروني</label>
                            <p class="fw-bold mb-0" id="customerEmail">ahmed.alsaeed@email.com</p>
                        </div>
                        <div class="col-md-12 mb-3">
                            <label class="text-muted mb-1">العنوان</label>
                            <p class="fw-bold mb-0" id="customerAddress">دبي - الخليج التجاري - برج الأعمال - الطابق 15</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- بيانات الطلب -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle text-primary me-2"></i>
                        بيانات الطلب
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="text-muted mb-1">نوع الخدمة</label>
                            <p class="fw-bold mb-0" id="serviceType">ربط حساب PayTabs</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted mb-1">نوع التفويض</label>
                            <p class="fw-bold mb-0" id="authorizationType">تفويض دفع إلكتروني</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted mb-1">القالب المستخدم</label>
                            <p class="fw-bold mb-0" id="templateUsed">قالب تفويض دفع - الإصدار 2.1</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted mb-1">المستخدم المنشئ</label>
                            <p class="fw-bold mb-0" id="createdBy">
                                <i class="fas fa-user-circle me-1"></i>
                                محمد أحمد (جامع بيانات)
                            </p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted mb-1">حالة الدفع</label>
                            <p class="mb-0">
                                <span class="badge bg-danger" id="paymentStatus">
                                    <i class="fas fa-times-circle me-1"></i>
                                    لم يتم الدفع
                                </span>
                            </p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted mb-1">المبلغ المطلوب</label>
                            <p class="fw-bold mb-0 text-success" id="amount">420 درهم</p>
                        </div>
                        <div class="col-md-12 mb-3">
                            <label class="text-muted mb-1">ملاحظات</label>
                            <p class="mb-0" id="notes">الطلب عاجل - يحتاج معالجة سريعة</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- المستندات المرفقة -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-paperclip text-primary me-2"></i>
                        المستندات المرفقة
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-shield-alt me-2"></i>
                        <strong>حماية البيانات:</strong> المستندات مشفّرة ومحمية. يُمنع النسخ أو التحميل غير المصرح.
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>نوع المستند</th>
                                    <th>اسم الملف</th>
                                    <th>الحجم</th>
                                    <th>تاريخ الرفع</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="documentsTable">
                                <tr>
                                    <td>1</td>
                                    <td>
                                        <i class="fas fa-id-card text-primary me-1"></i>
                                        صورة الهوية (الوجه الأمامي)
                                    </td>
                                    <td>emirates_id_front.jpg</td>
                                    <td>1.2 MB</td>
                                    <td>2025-01-15 10:30 ص</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewDocument(1)">
                                            <i class="fas fa-eye"></i> عرض
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>
                                        <i class="fas fa-id-card text-primary me-1"></i>
                                        صورة الهوية (الوجه الخلفي)
                                    </td>
                                    <td>emirates_id_back.jpg</td>
                                    <td>1.1 MB</td>
                                    <td>2025-01-15 10:30 ص</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewDocument(2)">
                                            <i class="fas fa-eye"></i> عرض
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>
                                        <i class="fas fa-file-signature text-primary me-1"></i>
                                        التفويض القانوني الموقّع
                                    </td>
                                    <td>authorization_signed.pdf</td>
                                    <td>856 KB</td>
                                    <td>2025-01-15 10:32 ص</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewDocument(3)">
                                            <i class="fas fa-eye"></i> عرض
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- سجل التدقيق -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-history text-primary me-2"></i>
                        سجل التدقيق والتعديلات
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>مهم:</strong> جميع التعديلات تُسجَّل تلقائيًا ولا يمكن حذفها.
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>التاريخ والوقت</th>
                                    <th>المستخدم</th>
                                    <th>الإجراء</th>
                                    <th>التفاصيل</th>
                                </tr>
                            </thead>
                            <tbody id="auditTable">
                                <tr>
                                    <td>2025-01-15 10:30 ص</td>
                                    <td>
                                        <i class="fas fa-user-circle text-primary me-1"></i>
                                        محمد أحمد
                                    </td>
                                    <td>
                                        <span class="badge bg-success">إنشاء طلب</span>
                                    </td>
                                    <td>تم إنشاء الطلب رقم QL-2025-001</td>
                                </tr>
                                <tr>
                                    <td>2025-01-15 10:35 ص</td>
                                    <td>
                                        <i class="fas fa-user-circle text-info me-1"></i>
                                        فاطمة علي
                                    </td>
                                    <td>
                                        <span class="badge bg-info">مراجعة</span>
                                    </td>
                                    <td>تمت مراجعة البيانات والمستندات</td>
                                </tr>
                                <tr>
                                    <td>2025-01-15 11:00 ص</td>
                                    <td>
                                        <i class="fas fa-user-circle text-warning me-1"></i>
                                        أحمد سالم
                                    </td>
                                    <td>
                                        <span class="badge bg-warning">تعديل</span>
                                    </td>
                                    <td>تم تعديل رقم الجوال</td>
                                </tr>
                                <tr>
                                    <td>2025-01-15 11:15 ص</td>
                                    <td>
                                        <i class="fas fa-robot text-secondary me-1"></i>
                                        النظام
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary">تنبيه</span>
                                    </td>
                                    <td>تحذير: لم يتم الدفع بعد</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- الإجراءات -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-cogs text-primary me-2"></i>
                        الإجراءات المتاحة
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-3 col-6">
                            <button class="btn btn-primary w-100" onclick="editRequest()">
                                <i class="fas fa-edit me-1"></i>
                                تعديل الطلب
                            </button>
                        </div>
                        <div class="col-md-3 col-6">
                            <button class="btn btn-success w-100" onclick="approveRequest()">
                                <i class="fas fa-check-circle me-1"></i>
                                موافقة
                            </button>
                        </div>
                        <div class="col-md-3 col-6">
                            <button class="btn btn-danger w-100" onclick="rejectRequest()">
                                <i class="fas fa-times-circle me-1"></i>
                                رفض
                            </button>
                        </div>
                        <div class="col-md-3 col-6">
                            <button class="btn btn-warning w-100" onclick="processPayment()">
                                <i class="fas fa-credit-card me-1"></i>
                                معالجة الدفع
                            </button>
                        </div>
                        <div class="col-md-3 col-6">
                            <button class="btn btn-info w-100" onclick="printRequest()">
                                <i class="fas fa-print me-1"></i>
                                طباعة
                            </button>
                        </div>
                        <div class="col-md-3 col-6">
                            <button class="btn btn-secondary w-100" onclick="exportRequest()">
                                <i class="fas fa-download me-1"></i>
                                تصدير PDF
                            </button>
                        </div>
                        <div class="col-md-3 col-6">
                            <button class="btn btn-outline-primary w-100" onclick="callCustomer()">
                                <i class="fas fa-phone me-1"></i>
                                اتصال بالعميل
                            </button>
                        </div>
                        <div class="col-md-3 col-6">
                            <button class="btn btn-outline-danger w-100" onclick="deleteRequest()">
                                <i class="fas fa-trash me-1"></i>
                                حذف
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <!-- Footer -->
        <div class="footer-wrapper">
            <div id="footer-placeholder"></div>
        </div>
    </div>

    <!-- Modals -->
    <div id="modal-placeholder"></div>

    <!-- Bootstrap JS -->
    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    
    <!-- Custom JS -->
    <script src="assets/js/custom.js"></script>

    <script>
        // تحميل المكونات
        document.addEventListener('DOMContentLoaded', async function() {
            await Promise.all([
                fetch('components/header.html').then(r => r.text()).then(html => {
                    document.getElementById('header-placeholder').innerHTML = html;
                }),
                fetch('components/sidebar.html').then(r => r.text()).then(html => {
                    document.getElementById('sidebar-placeholder').innerHTML = html;
                }),
                fetch('components/footer.html').then(r => r.text()).then(html => {
                    document.getElementById('footer-placeholder').innerHTML = html;
                }),
                fetch('components/confirm-modal.html').then(r => r.text()).then(html => {
                    document.getElementById('modal-placeholder').innerHTML = html;
                })
            ]);
        });

        // وظائف الصفحة
        function editRequest() {
            const requestId = new URLSearchParams(window.location.search).get('id') || '1';
            window.location.href = `edit-request.html?id=${requestId}`;
        }

        function approveRequest() {
            showConfirm(
                'موافقة على الطلب',
                'هل أنت متأكد من الموافقة على هذا الطلب؟',
                'success',
                function() {
                    showSuccess('تمت الموافقة على الطلب بنجاح!');
                }
            );
        }

        function rejectRequest() {
            showConfirm(
                'رفض الطلب',
                'هل أنت متأكد من رفض هذا الطلب؟',
                'danger',
                function() {
                    showSuccess('تم رفض الطلب وسيتم إبلاغ العميل.');
                }
            );
        }

        function processPayment() {
            showConfirm(
                'معالجة الدفع',
                'هل تريد معالجة الدفع الآن؟ سيتم توجيه العميل لصفحة الدفع الآمنة (PayTabs).',
                'warning',
                function() {
                    showSuccess('تم إنشاء رابط دفع آمن وسيتم إرساله للعميل.');
                }
            );
        }

        function printRequest() {
            window.print();
        }

        function exportRequest() {
            showSuccess('جارٍ تصدير الطلب إلى PDF...');
        }

        function callCustomer() {
            window.location.href = 'chat.html?customer=1';
        }

        function deleteRequest() {
            showConfirm(
                'حذف الطلب',
                'تحذير: هل أنت متأكد من حذف هذا الطلب؟ لن تتمكن من استعادته.',
                'danger',
                function() {
                    showSuccess('تم حذف الطلب.');
                    setTimeout(() => {
                        window.location.href = 'requests.html';
                    }, 1500);
                }
            );
        }

        function viewDocument(id) {
            showSuccess('جارٍ فتح المستند الآمن...');
        }
    </script>
</body>
</html>

