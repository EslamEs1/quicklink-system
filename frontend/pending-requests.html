<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الطلبات المعلقة - Quick Link System</title>
    
    <!-- Bootstrap CSS -->
    <link href="assets/css/bootstrap.rtl.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link href="assets/css/custom.css" rel="stylesheet">
    
    <!-- Custom Font -->
    <link href="assets/fonts/JF-Flat-Regular.ttf" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <div id="header-placeholder"></div>
    
    <!-- Sidebar -->
    <div id="sidebar-placeholder"></div>
    
    <!-- Main Content -->
    <div class="main-content-wrapper">
        <main class="main-content">
            <!-- Page Title -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">
                    <i class="fas fa-clock me-2 text-warning"></i>
                    الطلبات المعلقة
                    <span class="badge bg-warning text-dark ms-2">5</span>
                </h2>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="approveSelected()">
                        <i class="fas fa-check me-1"></i>
                        الموافقة على المحدد
                    </button>
                    <button class="btn btn-danger" onclick="rejectSelected()">
                        <i class="fas fa-times me-1"></i>
                        رفض المحدد
                    </button>
                </div>
            </div>

            <!-- Priority Alert -->
            <div class="alert alert-warning d-flex align-items-center mb-4" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <div>
                    <strong>تنبيه!</strong> لديك 2 طلب متأخر عن الموعد المحدد يحتاج إلى مراجعة فورية.
                </div>
            </div>

            <!-- Filters -->
            <div class="card shadow-custom mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <label class="form-label">فلترة حسب الأولوية</label>
                            <select class="form-control" id="priorityFilter">
                                <option value="all">جميع الأولويات</option>
                                <option value="urgent">عاجل</option>
                                <option value="high">عالية</option>
                                <option value="medium">متوسطة</option>
                                <option value="low">منخفضة</option>
                            </select>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">فلترة حسب المدة</label>
                            <select class="form-control" id="durationFilter">
                                <option value="all">جميع المدد</option>
                                <option value="overdue">متأخر</option>
                                <option value="today">اليوم</option>
                                <option value="week">هذا الأسبوع</option>
                                <option value="month">هذا الشهر</option>
                            </select>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">فلترة حسب المراجع</label>
                            <select class="form-control" id="reviewerFilter">
                                <option value="all">جميع المراجعين</option>
                                <option value="me">طلباتي فقط</option>
                                <option value="unassigned">غير مخصصة</option>
                            </select>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">&nbsp;</label>
                            <div class="d-grid">
                                <button class="btn btn-outline-primary" onclick="clearPendingFilters()">
                                    <i class="fas fa-times me-1"></i>
                                    مسح الفلاتر
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card stats-card border-warning">
                        <div class="card-body text-center">
                            <i class="fas fa-hourglass-half icon-large text-warning"></i>
                            <div class="stats-number text-warning">5</div>
                            <div class="stats-label">طلبات معلقة</div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card stats-card border-danger">
                        <div class="card-body text-center">
                            <i class="fas fa-exclamation-circle icon-large text-danger"></i>
                            <div class="stats-number text-danger">2</div>
                            <div class="stats-label">متأخرة</div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card stats-card border-info">
                        <div class="card-body text-center">
                            <i class="fas fa-user-clock icon-large text-info"></i>
                            <div class="stats-number text-info">3</div>
                            <div class="stats-label">مخصصة لي</div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card stats-card border-success">
                        <div class="card-body text-center">
                            <i class="fas fa-clock icon-large text-success"></i>
                            <div class="stats-number text-success">2.5</div>
                            <div class="stats-label">متوسط وقت المراجعة (ساعة)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pending Requests Table -->
            <div class="card shadow-custom">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-table me-2"></i>
                        قائمة الطلبات المعلقة
                    </h5>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="selectAll" onclick="toggleSelectAll()">
                        <label class="form-check-label" for="selectAll">
                            تحديد الكل
                        </label>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="pendingRequestsTable">
                            <thead>
                                <tr>
                                    <th width="40">
                                        <input type="checkbox" class="form-check-input">
                                    </th>
                                    <th>الأولوية</th>
                                    <th>الرقم المرجعي</th>
                                    <th>اسم العميل</th>
                                    <th>نوع الطلب</th>
                                    <th>المبلغ</th>
                                    <th>تاريخ الإنشاء</th>
                                    <th>الوقت المتبقي</th>
                                    <th>المراجع</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="priority-urgent">
                                    <td>
                                        <input type="checkbox" class="form-check-input request-checkbox">
                                    </td>
                                    <td>
                                        <span class="badge bg-danger">
                                            <i class="fas fa-exclamation-triangle"></i>
                                            عاجل
                                        </span>
                                    </td>
                                    <td><strong>QL-2025-001</strong></td>
                                    <td>أحمد محمد علي</td>
                                    <td>ربط حساب PayTabs</td>
                                    <td>420 درهم</td>
                                    <td>18 يناير 2025</td>
                                    <td>
                                        <span class="badge bg-danger">
                                            <i class="fas fa-clock"></i>
                                            متأخر بـ 2 ساعة
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-info">أنت</span>
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-action btn-view" onclick="viewPendingRequest(1)" title="عرض التفاصيل">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-action btn-success" onclick="approveRequest(1)" title="موافقة">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button class="btn btn-action btn-delete" onclick="rejectRequest(1)" title="رفض">
                                                <i class="fas fa-times"></i>
                                            </button>
                                            <button class="btn btn-action btn-warning" onclick="assignRequest(1)" title="إعادة تخصيص">
                                                <i class="fas fa-user"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="priority-high">
                                    <td>
                                        <input type="checkbox" class="form-check-input request-checkbox">
                                    </td>
                                    <td>
                                        <span class="badge bg-warning">
                                            <i class="fas fa-exclamation"></i>
                                            عالية
                                        </span>
                                    </td>
                                    <td><strong>QL-2025-002</strong></td>
                                    <td>فاطمة عبدالله السعد</td>
                                    <td>بوابة دفع إلكترونية</td>
                                    <td>750 درهم</td>
                                    <td>19 يناير 2025</td>
                                    <td>
                                        <span class="badge bg-warning">
                                            <i class="fas fa-clock"></i>
                                            متبقي ساعة
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-info">أنت</span>
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-action btn-view" onclick="viewPendingRequest(2)" title="عرض التفاصيل">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-action btn-success" onclick="approveRequest(2)" title="موافقة">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button class="btn btn-action btn-delete" onclick="rejectRequest(2)" title="رفض">
                                                <i class="fas fa-times"></i>
                                            </button>
                                            <button class="btn btn-action btn-warning" onclick="assignRequest(2)" title="إعادة تخصيص">
                                                <i class="fas fa-user"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="priority-medium">
                                    <td>
                                        <input type="checkbox" class="form-check-input request-checkbox">
                                    </td>
                                    <td>
                                        <span class="badge bg-primary">
                                            <i class="fas fa-minus"></i>
                                            متوسطة
                                        </span>
                                    </td>
                                    <td><strong>QL-2025-003</strong></td>
                                    <td>محمد سالم الأحمد</td>
                                    <td>تكامل بنكي</td>
                                    <td>650 درهم</td>
                                    <td>20 يناير 2025</td>
                                    <td>
                                        <span class="badge bg-success">
                                            <i class="fas fa-clock"></i>
                                            متبقي 5 ساعات
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary">غير مخصص</span>
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-action btn-view" onclick="viewPendingRequest(3)" title="عرض التفاصيل">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-action btn-success" onclick="approveRequest(3)" title="موافقة">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button class="btn btn-action btn-delete" onclick="rejectRequest(3)" title="رفض">
                                                <i class="fas fa-times"></i>
                                            </button>
                                            <button class="btn btn-action btn-warning" onclick="assignRequest(3)" title="تخصيص لي">
                                                <i class="fas fa-user-plus"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <div class="footer-wrapper">
        <div id="footer-placeholder"></div>
    </div>

    <!-- Modals -->
    <div id="modal-placeholder"></div>

    <!-- Bootstrap JS -->
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="assets/js/custom.js"></script>
    
    <!-- Page-specific JavaScript -->
    <script>
        function clearPendingFilters() {
            document.getElementById('priorityFilter').value = 'all';
            document.getElementById('durationFilter').value = 'all';
            document.getElementById('reviewerFilter').value = 'all';
            
            const rows = document.querySelectorAll('#pendingRequestsTable tbody tr');
            rows.forEach(row => {
                row.style.display = '';
            });
        }

        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.request-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }

        function approveSelected() {
            const selected = document.querySelectorAll('.request-checkbox:checked');
            if (selected.length === 0) {
                showWarning('الرجاء تحديد طلب واحد على الأقل');
                return;
            }
            
            showConfirm(
                'موافقة على طلبات متعددة',
                `هل أنت متأكد من الموافقة على ${selected.length} طلب؟`,
                'success',
                function() {
                    showSuccess(`تمت الموافقة على ${selected.length} طلب بنجاح`);
                }
            );
        }

        function rejectSelected() {
            const selected = document.querySelectorAll('.request-checkbox:checked');
            if (selected.length === 0) {
                showWarning('الرجاء تحديد طلب واحد على الأقل');
                return;
            }
            
            showConfirm(
                'رفض طلبات متعددة',
                `هل أنت متأكد من رفض ${selected.length} طلب؟`,
                'danger',
                function() {
                    showSuccess(`تم رفض ${selected.length} طلب`);
                }
            );
        }

        function viewPendingRequest(id) {
            window.location.href = `request-details.html?id=${id}`;
        }

        function approveRequest(id) {
            showConfirm(
                'موافقة على طلب',
                'هل أنت متأكد من الموافقة على هذا الطلب؟',
                'success',
                function() {
                    showSuccess(`تمت الموافقة على الطلب ${id}`);
                }
            );
        }

        function rejectRequest(id) {
            showConfirm(
                'رفض طلب',
                'هل أنت متأكد من رفض هذا الطلب؟',
                'danger',
                function() {
                    showSuccess(`تم رفض الطلب ${id}`);
                }
            );
        }

        function assignRequest(id) {
            showSuccess(`جارٍ تخصيص الطلب ${id}...`);
        }
    </script>
    
    <!-- Load Components -->
    <script>
        Promise.all([
            fetch('components/header.html').then(r => r.text()),
            fetch('components/sidebar.html').then(r => r.text()),
            fetch('components/footer.html').then(r => r.text()),
            fetch('components/confirm-modal.html').then(r => r.text())
        ]).then(([header, sidebar, footer, modal]) => {
            document.getElementById('header-placeholder').innerHTML = header;
            document.getElementById('sidebar-placeholder').innerHTML = sidebar;
            document.getElementById('footer-placeholder').innerHTML = footer;
            document.getElementById('modal-placeholder').innerHTML = modal;
        }).catch(error => {
            console.error('خطأ في تحميل المكونات:', error);
        });
    </script>
</body>
</html>
