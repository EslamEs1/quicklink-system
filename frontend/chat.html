<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุญุงุฏุซุงุช WhatsApp Business - Quick Link System</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/bootstrap.rtl.min.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/custom.css">
</head>
<body>
    <!-- Header -->
    <div id="header-placeholder"></div>

    <!-- Sidebar -->
    <div id="sidebar-placeholder"></div>

    <!-- Main Content -->
    <div class="main-content-wrapper">
        <main class="main-content">
            <!-- ุฑุฃุณ ุงูุตูุญุฉ -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="page-title mb-2">
                        <i class="fab fa-whatsapp text-success me-2"></i>
                        ูุญุงุฏุซุงุช WhatsApp Business
                    </h2>
                    <p class="page-subtitle text-muted">ูุงุฌูุฉ ุฏุฑุฏุดุฉ ุขููุฉ ุจุฏูู ุฅุธูุงุฑ ุงูุฃุฑูุงู</p>
                </div>
                <div>
                    <a href="customers.html" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-right me-1"></i>
                        ุฑุฌูุน ููุนููุงุก
                    </a>
                </div>
            </div>

            <!-- ุชูุจูู ุงูุฃูุงู -->
            <div class="alert alert-success mb-4">
                <i class="fas fa-shield-alt me-2"></i>
                <strong>ูุญุงุฏุซุงุช ุขููุฉ:</strong> ุฌููุน ุงููุญุงุฏุซุงุช ูุดูุฑุฉ. ุฃุฑูุงู ุงูุนููุงุก ูุฎููุฉ. ูู ุฑุณุงูุฉ ูุณุฌูุฉ ูู ุณุฌู ุงูุชุฏููู.
            </div>

            <!-- Chat Container -->
            <div class="chat-container">
                <!-- Sidebar - ูุงุฆูุฉ ุงููุญุงุฏุซุงุช -->
                <div class="chat-sidebar" id="chatSidebar">
                    <div class="p-3 bg-white border-bottom">
                        <input type="text" class="form-control" placeholder="ุจุญุซ ูู ุงููุญุงุฏุซุงุช..." id="searchConversations">
                    </div>
                    
                    <!-- ูุญุงุฏุซุฉ 1 - ูุดุทุฉ -->
                    <div class="conversation-item active" onclick="loadConversation(1)">
                        <div class="d-flex align-items-start">
                            <div class="avatar-circle bg-primary me-2">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between">
                                    <strong>ุฃุญูุฏ ูุญูุฏ ุนูู</strong>
                                    <small class="text-muted">10:30 ุต</small>
                                </div>
                                <small class="text-muted">ุดูุฑุงู ุนูู ุงููุชุงุจุนุฉ ุงูุณุฑูุนุฉ...</small>
                                <div class="mt-1">
                                    <span class="badge bg-success">ูุชุตู</span>
                                    <span class="unread-badge ms-1">2</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ูุญุงุฏุซุฉ 2 -->
                    <div class="conversation-item" onclick="loadConversation(2)">
                        <div class="d-flex align-items-start">
                            <div class="avatar-circle bg-warning me-2">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between">
                                    <strong>ูุงุทูุฉ ุนุจุฏุงููู</strong>
                                    <small class="text-muted">ุฃูุณ</small>
                                </div>
                                <small class="text-muted">ูุชู ุณูููู ุงูุทูุจ ุฌุงูุฒุ</small>
                                <div class="mt-1">
                                    <span class="badge bg-secondary">ุบูุฑ ูุชุตู</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ูุญุงุฏุซุฉ 3 -->
                    <div class="conversation-item" onclick="loadConversation(3)">
                        <div class="d-flex align-items-start">
                            <div class="avatar-circle bg-info me-2">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between">
                                    <strong>ูุญูุฏ ุณุงูู ุฃุญูุฏ</strong>
                                    <small class="text-muted">ุฃูุณ</small>
                                </div>
                                <small class="text-muted">ุชู ุงุณุชูุงู ุงูุฅูุตุงูุ ุดูุฑุงู</small>
                            </div>
                        </div>
                    </div>

                    <!-- ูุญุงุฏุซุฉ 4 -->
                    <div class="conversation-item" onclick="loadConversation(4)">
                        <div class="d-flex align-items-start">
                            <div class="avatar-circle bg-success me-2">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between">
                                    <strong>ุณุงุฑุฉ ุญุณู ูุญูุฏ</strong>
                                    <small class="text-muted">12 ููุงูุฑ</small>
                                </div>
                                <small class="text-muted">ูู ูููููู ุชุนุฏูู ุงูุจูุงูุงุชุ</small>
                                <div class="mt-1">
                                    <span class="unread-badge">1</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Conversation Area -->
                <div class="chat-conversation">
                    <!-- Chat Header -->
                    <div class="chat-header">
                        <div class="d-flex align-items-center">
                            <button class="btn btn-sm btn-light me-3 d-md-none" onclick="toggleChatSidebar()">
                                <i class="fas fa-arrow-right"></i>
                            </button>
                            <div class="avatar-circle bg-white text-primary me-3">
                                <i class="fas fa-user"></i>
                            </div>
                            <div>
                                <h5 class="mb-0" id="chatCustomerName">ุฃุญูุฏ ูุญูุฏ ุนูู</h5>
                                <small id="chatCustomerStatus">ูุชุตู ุงูุขู</small>
                            </div>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-light" onclick="viewCustomerProfile()">
                                <i class="fas fa-user-circle"></i>
                            </button>
                            <button class="btn btn-sm btn-light" onclick="viewRequestDetails()">
                                <i class="fas fa-file-alt"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Messages Area -->
                    <div class="chat-messages" id="chatMessages">
                        <!-- ุฑุณุงูุฉ ูุณุชููุฉ -->
                        <div class="message received">
                            <div class="avatar-circle bg-primary" style="width: 35px; height: 35px; font-size: 0.8rem;">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="message-bubble">
                                <div>ุงูุณูุงู ุนููููุ ุฃุฑูุฏ ุงูุงุณุชูุณุงุฑ ุนู ุญุงูุฉ ุงูุทูุจ</div>
                                <div class="message-time">9:45 ุต</div>
                            </div>
                        </div>

                        <!-- ุฑุณุงูุฉ ูุฑุณูุฉ -->
                        <div class="message sent">
                            <div class="avatar-circle bg-success" style="width: 35px; height: 35px; font-size: 0.8rem;">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div class="message-bubble">
                                <div>ูุนูููู ุงูุณูุงูุ ุทูุจู ููุฏ ุงููุฑุงุฌุนุฉ ุงูุขู</div>
                                <div class="message-time">9:50 ุต</div>
                            </div>
                        </div>

                        <!-- ุฑุณุงูุฉ ูุณุชููุฉ -->
                        <div class="message received">
                            <div class="avatar-circle bg-primary" style="width: 35px; height: 35px; font-size: 0.8rem;">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="message-bubble">
                                <div>ูู ุงููุฏุฉ ุงููุชููุนุฉ ููุงูุชูุงุกุ</div>
                                <div class="message-time">9:55 ุต</div>
                            </div>
                        </div>

                        <!-- ุฑุณุงูุฉ ูุฑุณูุฉ -->
                        <div class="message sent">
                            <div class="avatar-circle bg-success" style="width: 35px; height: 35px; font-size: 0.8rem;">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div class="message-bubble">
                                <div>ุนุงุฏุฉ ูุณุชุบุฑู ูู 24-48 ุณุงุนุฉ ุนูู</div>
                                <div class="message-time">10:00 ุต</div>
                            </div>
                        </div>

                        <!-- ุฑุณุงูุฉ ูุณุชููุฉ -->
                        <div class="message received">
                            <div class="avatar-circle bg-primary" style="width: 35px; height: 35px; font-size: 0.8rem;">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="message-bubble">
                                <div>ููุชุงุฒุ ุดูุฑุงู ุนูู ุงููุชุงุจุนุฉ ุงูุณุฑูุนุฉ ๐</div>
                                <div class="message-time">10:30 ุต</div>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Input -->
                    <div class="chat-input">
                        <form id="messageForm" onsubmit="return sendMessage(event)">
                            <div class="input-group">
                                <button type="button" class="btn btn-outline-secondary" onclick="attachFile()">
                                    <i class="fas fa-paperclip"></i>
                                </button>
                                <button type="button" class="btn btn-outline-secondary" onclick="attachImage()">
                                    <i class="fas fa-image"></i>
                                </button>
                                <input type="text" class="form-control" id="messageInput" placeholder="ุงูุชุจ ุฑุณุงูุชู ููุง..." required>
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </main>

        <!-- Footer -->
        <div class="footer-wrapper">
            <div id="footer-placeholder"></div>
        </div>
    </div>

    <!-- Modals -->
    <div id="modal-placeholder"></div>

    <!-- Bootstrap JS -->
    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    
    <!-- Custom JS -->
    <script src="assets/js/custom.js"></script>

    <script>
        // ุชุญููู ุงูููููุงุช
        document.addEventListener('DOMContentLoaded', async function() {
            await Promise.all([
                fetch('components/header.html').then(r => r.text()).then(html => {
                    document.getElementById('header-placeholder').innerHTML = html;
                }),
                fetch('components/sidebar.html').then(r => r.text()).then(html => {
                    document.getElementById('sidebar-placeholder').innerHTML = html;
                }),
                fetch('components/footer.html').then(r => r.text()).then(html => {
                    document.getElementById('footer-placeholder').innerHTML = html;
                }),
                fetch('components/confirm-modal.html').then(r => r.text()).then(html => {
                    document.getElementById('modal-placeholder').innerHTML = html;
                })
            ]);

            // ุชุญููู ุงููุญุงุฏุซุฉ ูู ุงูุฑุงุจุท
            const customerId = new URLSearchParams(window.location.search).get('customer');
            if (customerId) {
                loadConversation(customerId);
            }

            // ุงูุชูุฑูุฑ ุฅูู ุขุฎุฑ ุฑุณุงูุฉ
            scrollToBottom();
        });

        // ุชุญููู ูุญุงุฏุซุฉ
        function loadConversation(id) {
            console.log('ุชุญููู ุงููุญุงุฏุซุฉ:', id);
            // ููุง ูุชู ุชุญููู ุงููุญุงุฏุซุฉ ูู ุงูุณูุฑูุฑ
            
            // ุชุญุฏูุซ ุงููุดุท
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // ุฅุฎูุงุก ุงููุงุฆูุฉ ูู ุงูููุจุงูู
            if (window.innerWidth <= 768) {
                document.getElementById('chatSidebar').classList.remove('show');
            }
        }

        // ุฅุฑุณุงู ุฑุณุงูุฉ
        function sendMessage(event) {
            event.preventDefault();
            
            const messageInput = document.getElementById('messageInput');
            const messageText = messageInput.value.trim();
            
            if (messageText === '') return false;

            // ุฅุถุงูุฉ ุงูุฑุณุงูุฉ ูููุงุฌูุฉ
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ar-AE', {hour: '2-digit', minute: '2-digit'});
            
            const messageHTML = `
                <div class="message sent">
                    <div class="avatar-circle bg-success" style="width: 35px; height: 35px; font-size: 0.8rem;">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="message-bubble">
                        <div>${messageText}</div>
                        <div class="message-time">${timeStr}</div>
                    </div>
                </div>
            `;
            
            document.getElementById('chatMessages').insertAdjacentHTML('beforeend', messageHTML);
            
            // ูุณุญ ุงููุฏุฎู
            messageInput.value = '';
            
            // ุงูุชูุฑูุฑ ุฅูู ุขุฎุฑ ุฑุณุงูุฉ
            scrollToBottom();
            
            // ููุง ูุชู ุฅุฑุณุงู ุงูุฑุณุงูุฉ ููุณูุฑูุฑ
            
            return false;
        }

        // ุฅุฑูุงู ููู
        function attachFile() {
            showSuccess('ุงุฎุชูุงุฑ ููู ููุฅุฑูุงู... ููููู ุฅุฑูุงู PDF, DOC, XLS (ุญุฏ ุฃูุตู 10 MB)');
        }

        // ุฅุฑูุงู ุตูุฑุฉ
        function attachImage() {
            showSuccess('ุงุฎุชูุงุฑ ุตูุฑุฉ ููุฅุฑูุงู... ููููู ุฅุฑูุงู JPG, PNG (ุญุฏ ุฃูุตู 5 MB)');
        }

        // ุนุฑุถ ููู ุงูุนููู
        function viewCustomerProfile() {
            const customerId = new URLSearchParams(window.location.search).get('customer') || '1';
            window.location.href = `customer-details.html?id=${customerId}`;
        }

        // ุนุฑุถ ุชูุงุตูู ุงูุทูุจ
        function viewRequestDetails() {
            showSuccess('ุฌุงุฑู ูุชุญ ุชูุงุตูู ุขุฎุฑ ุทูุจ ููุนููู...');
        }

        // Toggle sidebar ูู ุงูููุจุงูู
        function toggleChatSidebar() {
            document.getElementById('chatSidebar').classList.toggle('show');
        }

        // ุงูุชูุฑูุฑ ุฅูู ุขุฎุฑ ุฑุณุงูุฉ
        function scrollToBottom() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // ุงูุจุญุซ ูู ุงููุญุงุฏุซุงุช
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchConversations');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const conversations = document.querySelectorAll('.conversation-item');
                    
                    conversations.forEach(conv => {
                        const text = conv.textContent.toLowerCase();
                        conv.style.display = text.includes(searchTerm) ? 'block' : 'none';
                    });
                });
            }
        });
    </script>
</body>
</html>

