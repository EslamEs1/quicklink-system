{% extends 'base.html' %}
{% load static %}

{% block content %}
<!-- Receipt for Printing -->
<div class="container-fluid" id="receipt-content">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card border-0 shadow">
                <div class="card-body p-4">
                    <!-- Header -->
                    <div class="text-center mb-4">
                        <h2 class="text-primary fw-bold">إيصال دفع</h2>
                        <p class="text-muted">Payment Receipt</p>
                        <hr>
                    </div>
                    
                    <!-- Receipt Info -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5 class="text-primary">معلومات الإيصال</h5>
                            <table class="table table-borderless">
                                <tr>
                                    <td class="fw-bold">رقم الإيصال:</td>
                                    <td>{{ payment.receipt_number|default:"غير محدد" }}</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">رقم المعاملة:</td>
                                    <td>{{ payment.transaction_id|default:"غير محدد" }}</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">تاريخ الدفع:</td>
                                    <td>{{ payment.created_at|date:"d يناير Y - H:i" }}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h5 class="text-primary">معلومات الدفع</h5>
                            <table class="table table-borderless">
                                <tr>
                                    <td class="fw-bold">المبلغ:</td>
                                    <td class="text-success fw-bold">{{ payment.amount }} درهم</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">طريقة الدفع:</td>
                                    <td>{{ payment.get_payment_method_display }}</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">الحالة:</td>
                                    <td>
                                        <span class="badge bg-success">{{ payment.get_status_display }}</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Customer Info -->
                    <div class="mb-4">
                        <h5 class="text-primary">معلومات العميل</h5>
                        <table class="table table-borderless">
                            <tr>
                                <td class="fw-bold">الاسم:</td>
                                <td>{{ payment.request.customer.full_name }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">رقم الهوية:</td>
                                <td>{{ payment.request.customer.masked_emirates_id }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">رقم الجوال:</td>
                                <td>{{ payment.request.customer.phone }}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- Request Info -->
                    <div class="mb-4">
                        <h5 class="text-primary">معلومات الطلب</h5>
                        <table class="table table-borderless">
                            <tr>
                                <td class="fw-bold">الرقم المرجعي:</td>
                                <td>{{ payment.request.reference_number }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">نوع الخدمة:</td>
                                <td>
                                    {% if payment.request.request_type %}
                                        {{ payment.request.request_type.name_arabic }}
                                    {% else %}
                                        غير محدد
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td class="fw-bold">تاريخ الطلب:</td>
                                <td>{{ payment.request.created_at|date:"d يناير Y" }}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- Notes -->
                    {% if payment.notes %}
                    <div class="mb-4">
                        <h5 class="text-primary">ملاحظات</h5>
                        <p class="border p-3 rounded bg-light">{{ payment.notes }}</p>
                    </div>
                    {% endif %}
                    
                    <!-- Footer -->
                    <div class="text-center mt-5">
                        <hr>
                        <p class="text-muted small">
                            شكراً لاستخدامكم خدماتنا<br>
                            Thank you for using our services
                        </p>
                        <p class="text-muted small">
                            تم إنشاء هذا الإيصال تلقائياً في {{ payment.created_at|date:"d/m/Y H:i" }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Print Button -->
<div class="text-center mt-3 mb-4">
    <button class="btn btn-primary" onclick="printReceipt()">
        <i class="fas fa-print me-2"></i>
        طباعة الإيصال
    </button>
    <a href="{% url 'payments:details' payment.id %}" class="btn btn-outline-secondary ms-2">
        <i class="fas fa-arrow-right me-2"></i>
        رجوع للتفاصيل
    </a>
</div>

<script>
function printReceipt() {
    // Hide the print button before printing
    const printButton = document.querySelector('.btn');
    const backButton = document.querySelector('.btn-outline-secondary');
    printButton.style.display = 'none';
    backButton.style.display = 'none';
    
    // Print the receipt
    window.print();
    
    // Show the buttons again after printing
    printButton.style.display = 'inline-block';
    backButton.style.display = 'inline-block';
}

// Auto print when page loads
window.addEventListener('load', function() {
    // Uncomment the line below to auto-print when page loads
    // printReceipt();
});
</script>

<style>
@media print {
    .btn, .btn-outline-secondary {
        display: none !important;
    }
    
    body {
        background: white !important;
    }
    
    .card {
        box-shadow: none !important;
        border: 1px solid #ddd !important;
    }
    
    .container-fluid {
        max-width: none !important;
    }
}
</style>
{% endblock content %}
