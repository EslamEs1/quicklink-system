{% extends 'base.html' %}
{% load static %}

{% block content %}
<!-- رأس الصفحة -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="page-title mb-2">
                        <i class="fas fa-user-shield text-primary me-2"></i>
                        إدارة صلاحيات الوصول
                    </h2>
                    <p class="page-subtitle text-muted">تحديد وتعديل صلاحيات المستخدمين في النظام</p>
                </div>
                <div>
                    <a href="{% url 'settings_app:users' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-right me-1"></i>
                        رجوع للمستخدمين
                    </a>
                </div>
            </div>

            <!-- معلومات مهمة -->
            <div class="alert alert-info mb-4">
                <i class="fas fa-info-circle me-2"></i>
                <strong>الصلاحيات الذكية:</strong> الموظف يرى فقط العملاء الذين لديهم طلبات مفتوحة معه. المدير يرى جميع الملفات. المشرف الأعلى يملك صلاحية كاملة.
            </div>

            <!-- الأدوار الأساسية -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-users-cog text-primary me-2"></i>
                        الأدوار الأساسية في النظام
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="card border-danger">
                                <div class="card-body text-center">
                                    <i class="fas fa-crown icon-large text-danger"></i>
                                    <h5 class="mt-3">مشرف أعلى (Admin)</h5>
                                    <p class="text-muted small">صلاحيات كاملة على النظام</p>
                                    <span class="badge bg-danger">صلاحية كاملة</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card border-primary">
                                <div class="card-body text-center">
                                    <i class="fas fa-user-tie icon-large text-primary"></i>
                                    <h5 class="mt-3">مدير النظام (Manager)</h5>
                                    <p class="text-muted small">إدارة الطلبات والموافقات</p>
                                    <span class="badge bg-primary">صلاحية متقدمة</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card border-info">
                                <div class="card-body text-center">
                                    <i class="fas fa-user-check icon-large text-info"></i>
                                    <h5 class="mt-3">مراجع (Reviewer)</h5>
                                    <p class="text-muted small">مراجعة وتدقيق الطلبات</p>
                                    <span class="badge bg-info">صلاحية محدودة</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card border-success">
                                <div class="card-body text-center">
                                    <i class="fas fa-user-edit icon-large text-success"></i>
                                    <h5 class="mt-3">جامع بيانات (Intake)</h5>
                                    <p class="text-muted small">إدخال وإنشاء الطلبات</p>
                                    <span class="badge bg-success">صلاحية أساسية</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card border-secondary">
                                <div class="card-body text-center">
                                    <i class="fas fa-user icon-large text-secondary"></i>
                                    <h5 class="mt-3">مشاهد (Viewer)</h5>
                                    <p class="text-muted small">عرض فقط بدون تعديل</p>
                                    <span class="badge bg-secondary">قراءة فقط</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- جدول الصلاحيات -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-table text-primary me-2"></i>
                        مصفوفة الصلاحيات التفصيلية
                    </h5>
                    <div>
                        <button class="btn btn-sm btn-outline-primary" onclick="selectAllPermissions()">
                            <i class="fas fa-check-double me-1"></i>
                            تحديد الكل
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" onclick="clearAllPermissions()">
                            <i class="fas fa-times me-1"></i>
                            إلغاء الكل
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <form id="permissionsForm" onsubmit="return savePermissions(event)">
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover" id="permissionsTable">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 200px;">المستخدم</th>
                                        <th style="width: 150px;">الدور</th>
                                        <th class="text-center">عرض</th>
                                        <th class="text-center">إنشاء</th>
                                        <th class="text-center">تعديل</th>
                                        <th class="text-center">حذف</th>
                                        <th class="text-center">موافقة</th>
                                        <th class="text-center">تقارير</th>
                                        <th class="text-center">تدقيق</th>
                                        <th class="text-center">إعدادات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- مستخدم 1 - مشرف أعلى -->
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="avatar-circle bg-danger me-2">
                                                    <i class="fas fa-crown"></i>
                                                </div>
                                                <strong>أحمد محمد</strong>
                                            </div>
                                        </td>
                                        <td><span class="badge bg-danger">Admin</span></td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" checked disabled>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" checked disabled>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" checked disabled>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" checked disabled>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" checked disabled>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" checked disabled>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" checked disabled>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" checked disabled>
                                        </td>
                                    </tr>

                                    <!-- مستخدم 2 - مدير -->
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="avatar-circle bg-primary me-2">
                                                    <i class="fas fa-user-tie"></i>
                                                </div>
                                                <strong>فاطمة علي</strong>
                                            </div>
                                        </td>
                                        <td><span class="badge bg-primary">Manager</span></td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user2_view" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user2_create" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user2_edit" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user2_delete">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user2_approve" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user2_reports" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user2_audit" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user2_settings">
                                        </td>
                                    </tr>

                                    <!-- مستخدم 3 - مراجع -->
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="avatar-circle bg-info me-2">
                                                    <i class="fas fa-user-check"></i>
                                                </div>
                                                <strong>سارة حسن</strong>
                                            </div>
                                        </td>
                                        <td><span class="badge bg-info">Reviewer</span></td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user3_view" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user3_create">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user3_edit" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user3_delete">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user3_approve">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user3_reports" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user3_audit" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user3_settings">
                                        </td>
                                    </tr>

                                    <!-- مستخدم 4 - جامع بيانات -->
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="avatar-circle bg-success me-2">
                                                    <i class="fas fa-user-edit"></i>
                                                </div>
                                                <strong>محمد سالم</strong>
                                            </div>
                                        </td>
                                        <td><span class="badge bg-success">Intake</span></td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user4_view" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user4_create" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user4_edit" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user4_delete">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user4_approve">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user4_reports">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user4_audit">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user4_settings">
                                        </td>
                                    </tr>

                                    <!-- مستخدم 5 - مشاهد -->
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="avatar-circle bg-secondary me-2">
                                                    <i class="fas fa-user"></i>
                                                </div>
                                                <strong>خالد أحمد</strong>
                                            </div>
                                        </td>
                                        <td><span class="badge bg-secondary">Viewer</span></td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user5_view" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user5_create">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user5_edit">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user5_delete">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user5_approve">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user5_reports" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user5_audit">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user5_settings">
                                        </td>
                                    </tr>

                                    <!-- مستخدم 6 -->
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="avatar-circle bg-success me-2">
                                                    <i class="fas fa-user-edit"></i>
                                                </div>
                                                <strong>نورة محمد</strong>
                                            </div>
                                        </td>
                                        <td><span class="badge bg-success">Intake</span></td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user6_view" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user6_create" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user6_edit" checked>
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user6_delete">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user6_approve">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user6_reports">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user6_audit">
                                        </td>
                                        <td class="text-center">
                                            <input type="checkbox" class="form-check-input" name="user6_settings">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- أزرار الحفظ -->
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <button type="submit" class="btn btn-success btn-lg w-100">
                                    <i class="fas fa-save me-2"></i>
                                    حفظ التغييرات
                                </button>
                            </div>
                            <div class="col-md-6">
                                <a href="{% url 'settings_app:users' %}" class="btn btn-outline-secondary btn-lg w-100">
                                    <i class="fas fa-times me-2"></i>
                                    إلغاء
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- توضيحات الصلاحيات -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-question-circle text-primary me-2"></i>
                        شرح الصلاحيات
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <h6 class="text-primary"><i class="fas fa-eye me-1"></i> عرض</h6>
                            <p class="text-muted small">إمكانية عرض وقراءة البيانات فقط</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6 class="text-success"><i class="fas fa-plus-circle me-1"></i> إنشاء</h6>
                            <p class="text-muted small">إمكانية إنشاء طلبات وسجلات جديدة</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6 class="text-warning"><i class="fas fa-edit me-1"></i> تعديل</h6>
                            <p class="text-muted small">إمكانية تعديل البيانات الموجودة</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6 class="text-danger"><i class="fas fa-trash me-1"></i> حذف</h6>
                            <p class="text-muted small">إمكانية حذف السجلات (محدودة جداً)</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6 class="text-info"><i class="fas fa-check-circle me-1"></i> موافقة</h6>
                            <p class="text-muted small">إمكانية الموافقة على الطلبات والمعاملات</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6 class="text-secondary"><i class="fas fa-chart-bar me-1"></i> تقارير</h6>
                            <p class="text-muted small">إمكانية عرض وتصدير التقارير</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6 class="text-dark"><i class="fas fa-history me-1"></i> تدقيق</h6>
                            <p class="text-muted small">إمكانية عرض سجل التدقيق الكامل</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6 class="text-primary"><i class="fas fa-cog me-1"></i> إعدادات</h6>
                            <p class="text-muted small">إمكانية تعديل إعدادات النظام</p>
                        </div>
                    </div>
                </div>
            </div>
{% endblock content %}
