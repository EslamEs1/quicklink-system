{% extends 'base.html' %}
{% load static %}

{% block content %}
<!-- رأس الصفحة -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="page-title mb-2">
            <i class="fas fa-trash text-danger me-2"></i>
            تأكيد حذف الطلب
        </h2>
        <p class="page-subtitle text-muted">تأكيد حذف الطلب نهائياً من النظام</p>
    </div>
    <div>
        <a href="{% url 'requests:detail' request.id %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-right me-1"></i>
            رجوع للطلب
        </a>
    </div>
</div>

<!-- تحذير مهم -->
<div class="alert alert-danger mb-4">
    <i class="fas fa-exclamation-triangle me-2"></i>
    <strong>تحذير مهم:</strong> هذا الإجراء سيقوم بحذف الطلب نهائياً من النظام. لا يمكن التراجع عن هذا الإجراء.
</div>

<!-- معلومات الطلب -->
<div class="row mb-4">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">
                    <i class="fas fa-file-alt me-2"></i>
                    معلومات الطلب المراد حذفه
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="text-muted mb-1">رقم الطلب</label>
                        <p class="fw-bold mb-0 text-primary">{{ request.reference_number }}</p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted mb-1">تاريخ الإنشاء</label>
                        <p class="fw-bold mb-0">{{ request.created_at|date:"Y-m-d H:i" }}</p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted mb-1">العميل</label>
                        <p class="fw-bold mb-0">{{ request.customer.full_name }}</p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted mb-1">نوع الطلب</label>
                        <p class="fw-bold mb-0">
                            {% if request.request_type %}
                                {{ request.request_type.name_arabic }}
                            {% else %}
                                غير محدد
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted mb-1">الحالة</label>
                        <p class="mb-0">
                            <span class="badge 
                                {% if request.status == 'new' %}bg-primary
                                {% elif request.status == 'in_review' %}bg-warning
                                {% elif request.status == 'approved' %}bg-success
                                {% elif request.status == 'completed' or request.status == 'paid' %}bg-info
                                {% elif request.status == 'rejected' or request.status == 'cancelled' %}bg-danger
                                {% else %}bg-secondary{% endif %}">
                                {{ request.get_status_display }}
                            </span>
                        </p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted mb-1">المبلغ</label>
                        <p class="fw-bold mb-0 text-success">{{ request.total_amount|default:"0" }} درهم</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <!-- إحصائيات الطلب -->
        <div class="card mb-3">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-chart-bar text-primary me-2"></i>
                    إحصائيات الطلب
                </h6>
            </div>
            <div class="card-body">
                <div class="stat-item mb-2">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="text-muted">
                            <i class="fas fa-paperclip me-1"></i>
                            المرفقات
                        </span>
                        <strong class="text-primary">{{ request.attachments.count }}</strong>
                    </div>
                </div>
                <hr>
                <div class="stat-item mb-2">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="text-muted">
                            <i class="fas fa-history me-1"></i>
                            سجل التدقيق
                        </span>
                        <strong class="text-info">{{ request.audit_logs.count }}</strong>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- إجراءات سريعة -->
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-bolt text-primary me-2"></i>
                    إجراءات سريعة
                </h6>
            </div>
            <div class="card-body">
                <a href="{% url 'requests:detail' request.id %}" class="btn btn-primary w-100 mb-2">
                    <i class="fas fa-eye me-1"></i>
                    عرض تفاصيل الطلب
                </a>
                {% if request.status == 'new' or request.status == 'in_review' %}
                <a href="{% url 'requests:edit' request.id %}" class="btn btn-warning w-100 mb-2">
                    <i class="fas fa-edit me-1"></i>
                    تعديل الطلب
                </a>
                {% endif %}
                <a href="{% url 'requests:list' %}" class="btn btn-secondary w-100">
                    <i class="fas fa-list me-1"></i>
                    رجوع للطلبات
                </a>
            </div>
        </div>
    </div>
</div>

<!-- ما سيتم حذفه -->
<div class="card mb-4">
    <div class="card-header bg-warning text-dark">
        <h5 class="mb-0">
            <i class="fas fa-info-circle me-2"></i>
            ما سيتم حذفه
        </h5>
    </div>
    <div class="card-body">
        <ul class="list-unstyled mb-0">
            <li class="mb-2">
                <i class="fas fa-check text-danger me-2"></i>
                <strong>الطلب:</strong> {{ request.reference_number }} وجميع بياناته
            </li>
            <li class="mb-2">
                <i class="fas fa-check text-danger me-2"></i>
                <strong>المرفقات:</strong> جميع الملفات المرفقة مع الطلب
            </li>
            <li class="mb-2">
                <i class="fas fa-check text-danger me-2"></i>
                <strong>سجل التدقيق:</strong> جميع التغييرات والتعديلات
            </li>
            <li class="mb-2">
                <i class="fas fa-check text-danger me-2"></i>
                <strong>معلومات الدفع:</strong> بيانات الدفع المرتبطة (إن وجدت)
            </li>
        </ul>
    </div>
</div>

<!-- ما لن يتم حذفه -->
<div class="card mb-4">
    <div class="card-header bg-success text-white">
        <h5 class="mb-0">
            <i class="fas fa-shield-alt me-2"></i>
            ما لن يتم حذفه
        </h5>
    </div>
    <div class="card-body">
        <ul class="list-unstyled mb-0">
            <li class="mb-2">
                <i class="fas fa-check text-success me-2"></i>
                <strong>بيانات العميل:</strong> ملف العميل سيبقى كما هو
            </li>
            <li class="mb-2">
                <i class="fas fa-check text-success me-2"></i>
                <strong>القوالب:</strong> القوالب المستخدمة ستبقى متاحة
            </li>
            <li class="mb-2">
                <i class="fas fa-check text-success me-2"></i>
                <strong>أنواع الطلبات:</strong> أنواع الطلبات ستبقى كما هي
            </li>
        </ul>
    </div>
</div>

<!-- أزرار الإجراء -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-cogs text-primary me-2"></i>
            تأكيد الإجراء
        </h5>
    </div>
    <div class="card-body">
        <div class="alert alert-danger">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>تحذير نهائي:</strong> بعد الضغط على "حذف نهائي" لا يمكن التراجع عن هذا الإجراء. تأكد من أنك تريد حذف هذا الطلب نهائياً.
        </div>
        
        <div class="row g-3">
            <div class="col-md-6">
                <form method="post" action="{% url 'requests:delete' request.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger w-100">
                        <i class="fas fa-trash me-1"></i>
                        حذف نهائي
                    </button>
                </form>
            </div>
            <div class="col-md-6">
                <a href="{% url 'requests:detail' request.id %}" class="btn btn-outline-secondary w-100">
                    <i class="fas fa-times me-1"></i>
                    إلغاء
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
