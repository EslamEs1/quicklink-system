{% extends 'base.html' %}
{% load static %}

{% block content %}
<!-- رأس الصفحة -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="page-title mb-2">
                        <i class="fas fa-user-edit text-primary me-2"></i>
                        تعديل بيانات العميل
                    </h2>
                    <p class="page-subtitle text-muted">تحديث معلومات الملف المركزي للعميل: <strong>{{ customer.full_name }}</strong></p>
                </div>
                <div>
                    <a href="{% url 'clients:detail' pk=customer.pk %}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-right me-1"></i>
                        رجوع للملف
                    </a>
                </div>
            </div>

            <!-- تنبيه أمني -->
            <div class="alert alert-warning mb-4">
                <i class="fas fa-shield-alt me-2"></i>
                <strong>تنبيه أمني:</strong> تعديل بيانات العميل سيُسجل في سجل التدقيق. تأكد من صحة البيانات قبل الحفظ.
            </div>

            <!-- نموذج التعديل -->
            <form method="post" action="{% url 'clients:edit' pk=customer.pk %}">
                {% csrf_token %}
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-user text-primary me-2"></i>
                            البيانات الأساسية
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">الاسم الكامل (عربي) <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" name="full_name" required 
                                       value="{{ customer.full_name }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">الاسم الكامل (إنجليزي)</label>
                                <input type="text" class="form-control" name="full_name_english" 
                                       value="{{ customer.full_name_english }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">رقم الهوية الإماراتية <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" name="emirates_id" required 
                                       value="{{ customer.emirates_id }}" 
                                       pattern="784-\d{4}-\d{7}-\d{1}" readonly>
                                <div class="form-text text-danger">
                                    <i class="fas fa-lock me-1"></i>
                                    رقم الهوية لا يمكن تعديله بعد الإنشاء (لأسباب أمنية)
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">رقم الجوال <span class="text-danger">*</span></label>
                                <input type="tel" class="form-control" name="phone" required 
                                       value="{{ customer.phone }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">البريد الإلكتروني</label>
                                <input type="email" class="form-control" name="email" 
                                       value="{{ customer.email }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">تاريخ الميلاد <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" name="date_of_birth" required 
                                       value="{{ customer.date_of_birth|date:'Y-m-d' }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">الجنس <span class="text-danger">*</span></label>
                                <select class="form-control" name="gender" required>
                                    <option value="">اختر الجنس</option>
                                    <option value="male" {% if customer.gender == 'male' %}selected{% endif %}>ذكر</option>
                                    <option value="female" {% if customer.gender == 'female' %}selected{% endif %}>أنثى</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">الجنسية <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" name="nationality" required 
                                       value="{{ customer.nationality }}">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- معلومات إضافية -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-info-circle text-primary me-2"></i>
                            معلومات إضافية
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">المهنة</label>
                                <input type="text" class="form-control" name="occupation" 
                                       value="{{ customer.occupation }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">اسم الشركة</label>
                                <input type="text" class="form-control" name="company_name" 
                                       value="{{ customer.company_name }}">
                            </div>
                            <div class="col-md-12 mb-3">
                                <label class="form-label">العنوان</label>
                                <textarea class="form-control" name="address" rows="3">{{ customer.address }}</textarea>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label class="form-label">ملاحظات داخلية</label>
                                <textarea class="form-control" name="notes" rows="3">{{ customer.notes }}</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- الحالة -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-toggle-on text-primary me-2"></i>
                            الحالة
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" name="is_active" id="isActive" 
                                           {% if customer.is_active %}checked{% endif %}>
                                    <label class="form-check-label" for="isActive">
                                        <strong>عميل نشط</strong>
                                    </label>
                                </div>
                                <small class="text-muted">يمكن إنشاء طلبات جديدة</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" name="is_verified" id="isVerified"
                                           {% if customer.is_verified %}checked{% endif %}>
                                    <label class="form-check-label" for="isVerified">
                                        <strong>عميل موثّق</strong>
                                    </label>
                                </div>
                                <small class="text-muted">تم التحقق من البيانات</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- معلومات النظام -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-database text-secondary me-2"></i>
                            معلومات النظام
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-calendar me-1"></i>
                                    تاريخ الإنشاء: <strong>{{ customer.created_at|date:"Y-m-d H:i" }}</strong>
                                </small>
                            </div>
                            <div class="col-md-6 mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-clock me-1"></i>
                                    آخر تحديث: <strong>{{ customer.updated_at|date:"Y-m-d H:i" }}</strong>
                                </small>
                            </div>
                            {% if customer.created_by %}
                            <div class="col-md-6 mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-user me-1"></i>
                                    تم الإنشاء بواسطة: <strong>{{ customer.created_by.get_full_name }}</strong>
                                </small>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- أزرار الإجراءات -->
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="fas fa-save me-2"></i>
                                    حفظ التعديلات
                                </button>
                                <button type="reset" class="btn btn-outline-secondary btn-lg">
                                    <i class="fas fa-undo me-2"></i>
                                    إلغاء التعديلات
                                </button>
                            </div>
                            <a href="{% url 'clients:detail' pk=customer.pk %}" class="btn btn-outline-danger btn-lg">
                                <i class="fas fa-times me-2"></i>
                                إلغاء
                            </a>
                        </div>
                    </div>
                </div>
            </form>
{% endblock content %}

